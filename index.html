<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Lenguaje de Se√±as de Puerto Rico</title>
    <link rel="stylesheet" href="myStyles.css">
</head>
<body>
<header>
    <a href="https://www.sagrado.edu">
        <img src="sagrado-blanco.png" alt="Sagrado Logo">
    </a>
    <nav>
        <ul>
            <li><a href="index.html">Inicio</a></li>
            <li><a href="https://www.sagrado.edu">Conoce a Sagrado</a></li>
            <li><a href="about.html">Sobre Nosotros</a></li>
        </ul>
    </nav>
    <h1><a href="importance.html">Lenguaje de Se√±as de Puerto Rico</a></h1>
</header>
<!--    TODO: Find a better method to handle these menus-->
<section class="dropdown-section">
    <div class="dropdown">
        <button class="dropbtn">Familia</button>
        <div class="dropdown-content">
            <a href="#" data-word="mama">Mam√°</a>
            <a href="#" data-word="papa">Pap√°</a>
            <a href="#" data-word="abuela">Abuela</a>
            <a href="#" data-word="hija">Hija</a>
            <a href="#" data-word="hijo">Hijo</a>
            <a href="#" data-word="bebe">Beb√©</a>
            <a href="#" data-word="hermana">Hermana</a>
            <a href="#" data-word="persona">Persona</a>
            <a href="#" data-word="nombre">Nombre</a>
            <a href="#" data-word="individual">Individual</a>
        </div>
    </div>
    <div class="dropdown">
        <button class="dropbtn">Pueblos</button>
        <div class="dropdown-content">
            <a href="#" data-word="bayamon">Bayam√≥n</a>
            <a href="#" data-word="caguas">Caguas</a>
            <a href="#" data-word="carolina">Carolina</a>
            <a href="#" data-word="mayaguez">Mayag√ºez</a>
            <a href="#" data-word="ponce">Ponce</a>
            <a href="#" data-word="san_juan">San Juan</a>
        </div>
    </div>
    <div class="dropdown">
        <button class="dropbtn">Emociones</button>
        <div class="dropdown-content">
            <a href="#" data-word="amor">Amor</a>
            <a href="#" data-word="por_favor">Por Favor</a>
            <a href="#" data-word="perdon">Perd√≥n</a>
            <a href="#" data-word="dolor">Dolor</a>
            <a href="#" data-word="gracias">Gracias</a>
        </div>
    </div>
    <div class="dropdown">
        <button class="dropbtn">Comida</button>
        <div class="dropdown-content">
            <a href="#" data-word="arroz">Arroz</a>
            <a href="#" data-word="habichuela">Habichuelas</a>
        </div>
    </div>
    <div class="dropdown">
        <button class="dropbtn">Ocupaci√≥n</button>
        <div class="dropdown-content">
            <a href="#" data-word="policia">Polic√≠a</a>
            <a href="#" data-word="interprete">Interprete</a>
        </div>
    </div>
    <div class="dropdown">
        <button class="dropbtn">Pronombres</button>
        <div class="dropdown-content">
            <a href="#" data-word="yo">Yo</a>
            <a href="#" data-word="tu">Tu</a>
            <a href="#" data-word="nosotros">Nosotros</a>
            <a href="#" data-word="ella">Ella</a>
            <a href="#" data-word="ellos">Ellos</a>
            <a href="#" data-word="ellas">Ellas</a>
        </div>
    </div>
    <div class="dropdown">
        <button class="dropbtn">Interrogantes</button>
        <div class="dropdown-content">
            <a href="#" data-word="si">S√≠</a>
            <a href="#" data-word="no">No</a>
            <a href="#" data-word="cuanto">Cu√°nto</a>
            <a href="#" data-word="donde">D√≥nde</a>
            <a href="#" data-word="que">Qu√©</a>
            <a href="#" data-word="quien">Qui√©n</a>
            <a href="#" data-word="precio">Precio</a>
        </div>
    </div>
    <div class="dropdown">
        <button class="dropbtn">Acciones</button>
        <div class="dropdown-content">
            <a href="#" data-word="ayudar">Ayudar</a>
            <a href="#" data-word="ayudame">Ayudame</a>
            <a href="#" data-word="dormir">Dormir</a>
            <a href="#" data-word="esperar">Esperar</a>
            <a href="#" data-word="mirar">Mirar</a>
            <a href="#" data-word="defender">Defender</a>
            <a href="#" data-word="descansar">Descansar</a>
            <a href="#" data-word="cambiar">cambiar</a>
        </div>
    </div>
    <div class="dropdown">
        <button class="dropbtn">Comunicaci√≥n</button>
        <div class="dropdown-content">
            <a href="#" data-word="hablar">Hablar</a>
            <a href="#" data-word="interpretar">Interpretar</a>
            <a href="#" data-word="senas">Se√±as</a>
            <a href="#" data-word="telefono">Tel√©fono</a>
            <a href="#" data-word="television">Televisi√≥n</a>
            <a href="#" data-word="conversar">Conversar</a>
            <a href="#" data-word="explicar">Explicar</a>
        </div>
    </div>
    <div class="dropdown">
        <button class="dropbtn">Acci√≥n Mental</button>
        <div class="dropdown-content">
            <a href="#" data-word="me_olvide">Me Olvid√©</a>
            <a href="#" data-word="no_entender">No entender</a>
            <a href="#" data-word="no_se">No S√©</a>
            <a href="#" data-word="saber">Saber</a>
            <a href="#" data-word="idea">Idea</a>
            <a href="#" data-word="significado">Significado</a>
            <a href="#" data-word="conflicto">Conflicto</a>
            <a href="#" data-word="presion">Presi√≥n</a>
            <a href="#" data-word="recordar">Recordar</a>
            <a href="#" data-word="comparar">Comparar</a>
            <a href="#" data-word="influenciar">Influenciar</a>
            <a href="#" data-word="decidir">Decidir</a>
            <a href="#" data-word="cooperacion">Cooperaci√≥n</a>
            <a href="#" data-word="dejalo">Dejalo</a>
            <a href="#" data-word="discusion">Discusi√≥n</a>
            <a href="#" data-word="junto">Junto</a>
        </div>
    </div>
    <!-- Add more dropdowns for other categories as needed -->
</section>
<section class="centered-section">
    <h2>Buscar GIFs</h2>
    <form id="gifSearchForm">
        <label for="searchTerm"></label>
        <input type="text" id="searchTerm" name="searchTerm" placeholder="Termino a buscar" autofocus>
        <!-- Microphone button for voice search -->
        <button type="button" id="voiceSearchBtn" title="Haga click para b√∫squeda de voz">üé§</button>
        <button type="submit">B√∫squeda</button>
    </form>
    <div id="result">
        <div id="loader" class="loader" style="display: none;"></div>
    </div>
</section>

<!--TODO: Clean up scripts, or possibly move them to a separate file-->
<script>
    // Function to load the GIF based on a given search term
    let isLoading = false;

    function removeUnderscore(searchTerm) {
        let underscoreIndex = 0;
        let newString = '';
        if (searchTerm.includes('_')) {
            console.log('It has it!')
            underscoreIndex = searchTerm.indexOf('_');
            console.log('The position is ' + underscoreIndex)
        } else {
            console.log("It doesn't have it")
        }
        if (underscoreIndex) {
            newString = searchTerm.substring(0, underscoreIndex) + " " + searchTerm.substring(underscoreIndex + 1)
            return newString;

        }
    }

    function loadGif(searchTerm) {
        if (isLoading) {
            return;
        }
        isLoading = true;
        const resultDiv = document.getElementById('result');

        // Basic validation (adjust as needed)
        if (!searchTerm || searchTerm.length > 20) {
            resultDiv.innerHTML = '<p class="alert">Un t√©rmino de b√∫squeda es necesario y debe ser menos de 20 caracteres.</p>';
            isLoading = false;
            return;
        }

        // Create a container to hold the result text
        const container = document.createElement('div');

        let noUnderscoreTerm = removeUnderscore(searchTerm);

        if (searchTerm.includes('_')) {
            container.innerHTML = `<h3>Tu frase es ${noUnderscoreTerm}</h3>`
        } else {
            container.innerHTML = `<h3>Tu palabra es ${searchTerm}</h3>`
        }

        // Clear any previous result and show the loader
        resultDiv.innerHTML = '';
        const loader = document.createElement('div');
        loader.className = 'loader';
        resultDiv.appendChild(loader);

        // Create an image element and start loading the GIF
        const img = new Image();
        img.src = `gifs/${searchTerm}.gif`;

        img.onload = function () {
            // Remove the loader once the image has loaded successfully
            if (resultDiv.contains(loader)) {
                resultDiv.removeChild(loader);
            }
            container.appendChild(img);
            resultDiv.appendChild(container);
            isLoading = false;
        };

        img.onerror = function () {
            if (resultDiv.contains(loader)) {
                resultDiv.removeChild(loader);
            }
            container.innerHTML += `<p>¬°Oops! ¬°Al parecer a√∫n no tenemos ese GIF!</p>
                                  <p>Mientras tanto, mira que lindo el perrito:</p>
                                  <img src="https://placedog.net/500" alt="Foto de perrito">`;
            resultDiv.appendChild(container);
            isLoading = false;
        };
    }

    // Handle search form submission
    document.getElementById('gifSearchForm').addEventListener('submit', function (event) {
        event.preventDefault();
        const searchTermInput = document.getElementById('searchTerm');
        const searchTerm = searchTermInput.value.toLowerCase().trim();

        // Normalize and remove diacritics, then replace spaces with underscores
        const sanitizedSearchTerm = searchTerm.normalize('NFD')
            .replace(/[\u0300-\u036f]/g, '') // Remove accents (combining diacritical marks)
            .replace(/\s+/g, '_');           // Replace spaces with underscores

        loadGif(sanitizedSearchTerm);
    })

    // Attach click handlers to dropdown links
    document.querySelectorAll('.dropdown-content a').forEach(function (link) {
        link.addEventListener('click', function (event) {
            event.preventDefault(); // Prevent default link behavior
            const word = this.getAttribute('data-word');

            // If you want, you could update the search field as well:
            document.getElementById('searchTerm').value = word;

            // Load the gif for the clicked dropdown item
            loadGif(word);
        });
    });

    // Wait until the DOM is fully loaded
    document.addEventListener('DOMContentLoaded', function () {
        // Get all the dropdown elements
        const dropdowns = document.querySelectorAll('.dropdown');

        // Add click event listeners to each dropdowns button and its links
        dropdowns.forEach(function (dropdown) {
            const dropbtn = dropdown.querySelector('.dropbtn');
            const dropdownContent = dropdown.querySelector('.dropdown-content');

            // Toggle dropdown content when the button is clicked
            dropbtn.addEventListener('click', function (event) {
                event.stopPropagation(); // Prevent event from bubbling up to document
                // Toggle the display style
                if (dropdownContent.style.display === 'block') {
                    dropdownContent.style.display = 'none';
                } else {
                    // Optionally, close any other open dropdowns before showing this one
                    closeAllDropdowns();
                    dropdownContent.style.display = 'block';
                }
            });

            // Hide the dropdown when one of its items is clicked
            const links = dropdownContent.querySelectorAll('a');
            links.forEach(function (link) {
                link.addEventListener('click', function (event) {
                    event.preventDefault();
                    // Here you would handle the selected word if needed (e.g., load a GIF)

                    // Hide the dropdown list
                    dropdownContent.style.display = 'none';
                });
            });
        });

        // Close any open dropdowns when clicking outside
        document.addEventListener('click', function () {
            closeAllDropdowns();
        });
// Check for browser support of the Web Speech API
        window.SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

        if (window.SpeechRecognition) {
            const recognition = new window.SpeechRecognition();
            // Set language to Puerto Rico Spanish
            recognition.lang = 'es-PR';
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;

            const voiceBtn = document.getElementById('voiceSearchBtn');
            const searchInput = document.getElementById('searchTerm');

            voiceBtn.addEventListener('click', function () {
                // Start voice recognition
                recognition.start();
                voiceBtn.textContent = 'üéôÔ∏è...'; // Visual feedback indicating listening
            });

            recognition.addEventListener('result', function (event) {
                // Set the recognized speech in the search input field
                searchInput.value = event.results[0][0].transcript;
            });

            recognition.addEventListener('speechend', function () {
                recognition.stop();
                voiceBtn.textContent = 'üé§';

                // Sanitize the search term: convert to lowercase, remove accents, replace spaces with underscores
                setTimeout(function () {
                    const searchTerm = searchInput.value.toLowerCase().trim();
                    const sanitizedSearchTerm = searchTerm.normalize('NFD')
                        .replace(/[\u0300-\u036f]/g, '') // Remove combining diacritical marks
                        .replace(/\s+/g, '_');           // Replace spaces with underscores

                    // Immediately call the function to load the GIF based on the sanitized search term
                    loadGif(sanitizedSearchTerm);
                }, 200)
            });

            recognition.addEventListener('error', function (event) {
                console.error('Error in speech recognition: ' + event.error);
                voiceBtn.textContent = 'üé§';
            });
        } else {
            // If the browser does not support speech recognition, hide the voice search button
            document.getElementById('voiceSearchBtn').style.display = 'none';
            console.warn('Your browser does not support speech recognition.');
        }

        // Function to close all dropdown menus
        function closeAllDropdowns() {
            dropdowns.forEach(function (dropdown) {
                const content = dropdown.querySelector('.dropdown-content');
                content.style.display = 'none';
            });
        }
    });
</script>
</body>
</html>